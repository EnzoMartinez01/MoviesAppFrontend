<div class="movies-adm-container">
  <div class="breadcrumb-section">
    <span class="breadcrumb">
      <span class="breadcrumb-link" (click)="goToAdmin()">Administrativo</span> / Movies
    </span>
  </div>
  
  <div class="header-and-search">
    <div class="header-section">
      <h1>Gestión de Películas</h1>
      <button mat-raised-button color="primary" class="add-button" (click)="openAddDialog()">
        <mat-icon>add</mat-icon>
        Agregar Película
      </button>
    </div>

    <div class="search-section">
      <div class="search-container">
        <mat-icon class="search-icon">search</mat-icon>
        <input
          type="text"
          placeholder="Buscar películas..."
          [(ngModel)]="searchTerm"
          (input)="filterMovies()"
          class="search-input">
      </div>
    </div>
  </div>

  <div class="movies-table">
    <div class="table-wrapper">
      <table mat-table [dataSource]="filteredMovies" class="mat-elevation-z8">
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>Imagen</th>
        <td mat-cell *matCellDef="let movie">
          <img [src]="movie.movieImage" [alt]="movie.titleMovie" class="movie-thumbnail">
        </td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Título</th>
        <td mat-cell *matCellDef="let movie">{{ movie.titleMovie }}</td>
      </ng-container>

      <ng-container matColumnDef="genre">
        <th mat-header-cell *matHeaderCellDef>Género</th>
        <td mat-cell *matCellDef="let movie">{{ movie.genreName }}</td>
      </ng-container>

      <ng-container matColumnDef="year">
        <th mat-header-cell *matHeaderCellDef>Año</th>
        <td mat-cell *matCellDef="let movie">{{ movie.releaseDate }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let movie">
          <div class="action-buttons">
            <button mat-icon-button color="primary" (click)="editMovie(movie)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteMovie(movie)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    </div>

    <div class="pagination-container">
      <div class="pagination-info">
        <span>Mostrando {{ (currentPage * pageSize) + 1 }} - {{ Math.min((currentPage + 1) * pageSize, totalElements) }} de {{ totalElements }} películas</span>
      </div>
      <div class="pagination-controls">
        <button mat-icon-button [disabled]="currentPage === 0" (click)="previousPage()">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <span class="page-info">{{ currentPage + 1 }} / {{ totalPages }}</span>
        <button mat-icon-button [disabled]="currentPage >= totalPages - 1" (click)="nextPage()">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de edición -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Editar Película</h2>
        <button mat-icon-button (click)="closeEditModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="modal-body" *ngIf="editingMovie">
        <div class="form-row">
          <label>Título:</label>
          <input [(ngModel)]="editingMovie.titleMovie" class="form-input">
        </div>

        <div class="form-row">
          <label>Sinopsis:</label>
          <textarea [(ngModel)]="editingMovie.synopsisMovie" class="form-textarea"></textarea>
        </div>

        <div class="form-row">
          <label>Duración (min):</label>
          <input type="number" [(ngModel)]="editingMovie.duration" class="form-input">
        </div>

        <div class="form-row">
          <label>Fecha de lanzamiento:</label>
          <input [(ngModel)]="editingMovie.releaseDate" class="form-input">
        </div>

        <div class="form-row">
          <label>Idioma:</label>
          <input [(ngModel)]="editingMovie.language" class="form-input">
        </div>

        <div class="form-row">
          <label>Clasificación:</label>
          <input [(ngModel)]="editingMovie.pg" class="form-input">
        </div>

        <div class="form-row">
          <label>Género:</label>
          <select [(ngModel)]="editingMovie.genreName" class="form-input">
            <option value="">Seleccionar género</option>
            <option *ngFor="let genre of genres" [value]="genre.genreName">
              {{ genre.genreName }}
            </option>
          </select>
        </div>

        <div class="form-row">
          <label>URL de imagen:</label>
          <input [(ngModel)]="editingMovie.movieImage" class="form-input">
        </div>

        <div class="form-row">
          <label>URL de película:</label>
          <input [(ngModel)]="editingMovie.movieUrl" class="form-input">
        </div>

        <div class="form-row">
          <label>URL de tráiler:</label>
          <input [(ngModel)]="editingMovie.urlTrailer" class="form-input">
        </div>
      </div>

      <div class="modal-footer">
        <button mat-button (click)="closeEditModal()">Cancelar</button>
        <button mat-raised-button color="primary" (click)="saveMovie()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal de agregar -->
  <div *ngIf="showAddModal" class="modal-overlay" (click)="closeAddModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Agregar Película</h2>
        <button mat-icon-button (click)="closeAddModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-row">
          <label>Título: *</label>
          <input [(ngModel)]="newMovie.title" class="form-input" required>
        </div>

        <div class="form-row">
          <label>Sinopsis: *</label>
          <textarea [(ngModel)]="newMovie.synopsis" class="form-textarea" required></textarea>
        </div>

        <div class="form-row">
          <label>Duración (min):</label>
          <input type="number" [(ngModel)]="newMovie.durationInMinutes" class="form-input">
        </div>

        <div class="form-row">
          <label>Fecha de lanzamiento:</label>
          <input [(ngModel)]="newMovie.releaseDate" class="form-input">
        </div>

        <div class="form-row">
          <label>Fecha de Premier:</label>
          <input [(ngModel)]="newMovie.premiereDate" class="form-input">
        </div>

        <div class="form-row">
          <label>Idioma:</label>
          <input [(ngModel)]="newMovie.language" class="form-input">
        </div>

        <div class="form-row">
          <label>Clasificación:</label>
          <input [(ngModel)]="newMovie.ranking" class="form-input">
        </div>

        <div class="form-row">
          <label>Género: *</label>
          <select [(ngModel)]="newMovie.genre" class="form-input" required>
            <option value="">Seleccionar género</option>
            <option *ngFor="let genre of genres" [value]="genre.idGenre">
              {{ genre.genreName }}
            </option>
          </select>
        </div>

        <div class="form-row">
          <label>URL de imagen:</label>
          <input [(ngModel)]="newMovie.coverImage" class="form-input">
        </div>

        <div class="form-row">
          <label>URL de película:</label>
          <input [(ngModel)]="newMovie.urlMovie" class="form-input">
        </div>

        <div class="form-row">
          <label>URL de tráiler:</label>
          <input [(ngModel)]="newMovie.urlTrailer" class="form-input">
        </div>
      </div>

      <div class="modal-footer">
        <button mat-button (click)="closeAddModal()">Cancelar</button>
        <button mat-raised-button color="primary" (click)="addMovie()">Agregar</button>
      </div>
    </div>
  </div>
</div>
